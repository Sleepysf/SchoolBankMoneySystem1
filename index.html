<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>School Bank | Money System</title>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: { sans: ['Plus Jakarta Sans', 'sans-serif'] },
                    animation: { 'spring': 'spring 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275)', 'slide-up': 'slideUp 0.3s ease-out' },
                    keyframes: {
                        spring: { '0%': { transform: 'scale(0.9) translateY(10px)', opacity: '0' }, '100%': { transform: 'scale(1) translateY(0)', opacity: '1' } },
                        slideUp: { '0%': { transform: 'translateY(20px)', opacity: '0' }, '100%': { transform: 'translateY(0)', opacity: '1' } }
                    }
                }
            }
        }
    </script>
    <style>
        * { -webkit-tap-highlight-color: transparent; }
        body { overscroll-behavior-y: contain; user-select: none; }
        input, textarea { user-select: auto; }
        .glass { backdrop-filter: blur(16px); background: rgba(255, 255, 255, 0.7); }
        .dark .glass { background: rgba(15, 23, 42, 0.8); }
        .bg-mesh {
            background-color: #f8fafc;
            background-image: radial-gradient(at 0% 0%, rgba(99, 102, 241, 0.15) 0px, transparent 50%), radial-gradient(at 100% 0%, rgba(244, 114, 182, 0.15) 0px, transparent 50%);
        }
        .dark .bg-mesh {
            background-color: #020617;
            background-image: radial-gradient(at 0% 0%, rgba(99, 102, 241, 0.1) 0px, transparent 50%), radial-gradient(at 100% 0%, rgba(244, 114, 182, 0.1) 0px, transparent 50%);
        }
        .pb-safe { padding-bottom: env(safe-area-inset-bottom); }
        .pt-safe { padding-top: env(safe-area-inset-top); }
    </style>
</head>
<body class="bg-mesh text-slate-900 dark:text-slate-100 transition-colors duration-500 font-sans min-h-screen">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        const Icon = ({ name, size = 20, className = "" }) => {
            const icons = {
                chart: <path d="M18 20V10M12 20V4M6 20v-6" fill="none" stroke="currentColor" strokeWidth="2.5" strokeLinecap="round"/>,
                user: <path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2M12 7a4 4 0 1 0 0-8 4 4 0 0 0 0 8z" fill="none" stroke="currentColor" strokeWidth="2.5"/>,
                plus: <path d="M12 5v14M5 12h14" stroke="currentColor" strokeWidth="2.5"/>,
                send: <path d="M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z" fill="none" stroke="currentColor" strokeWidth="2.5"/>,
                chevron: <polyline points="9 18 15 12 9 6" fill="none" stroke="currentColor" strokeWidth="2.5"/>,
                lock: <React.Fragment><rect x="3" y="11" width="18" height="11" rx="2" ry="2" stroke="currentColor" strokeWidth="2.5"/><path d="M7 11V7a5 5 0 0 1 10 0v4" stroke="currentColor" strokeWidth="2.5"/></React.Fragment>
            };
            return <svg width={size} height={size} viewBox="0 0 24 24" className={className}>{icons[name]}</svg>;
        };

        function App() {
            const [user, setUser] = useState(() => JSON.parse(localStorage.getItem('bv_user')));
            const [profiles, setProfiles] = useState(() => JSON.parse(localStorage.getItem('bv_profiles') || '[]'));
            const [activeProfileId, setActiveProfileId] = useState(() => localStorage.getItem('bv_active_profile_id'));
            const [transactions, setTransactions] = useState([]);
            const [view, setView] = useState('dash');
            
            const [showAddModal, setShowAddModal] = useState(false);
            const [showTransferModal, setShowTransferModal] = useState(false);
            const [showAdminModal, setShowAdminModal] = useState(false);
            const [isAdminLoggedIn, setIsAdminLoggedIn] = useState(false);
            const [errorMsg, setErrorMsg] = useState('');

            useEffect(() => {
                if (activeProfileId) {
                    const saved = JSON.parse(localStorage.getItem(`bv_txs_${activeProfileId}`) || '[]');
                    setTransactions(saved.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp)));
                    localStorage.setItem('bv_active_profile_id', activeProfileId);
                }
            }, [activeProfileId]);

            const activeProfile = useMemo(() => profiles.find(p => p.id === activeProfileId), [profiles, activeProfileId]);
            const stats = useMemo(() => {
                const income = transactions.filter(t => t.type === 'income').reduce((s, t) => s + t.amount, 0);
                const expense = transactions.filter(t => t.type === 'expense').reduce((s, t) => s + t.amount, 0);
                return { balance: income - expense, income, expense };
            }, [transactions]);

            const handleAuth = (e) => {
                e.preventDefault();
                const email = e.target.email.value;
                const mockUser = { uid: btoa(email), email };
                setUser(mockUser);
                localStorage.setItem('bv_user', JSON.stringify(mockUser));
            };

            const handleCreateProfile = (e) => {
                e.preventDefault();
                const newProfile = {
                    id: Math.floor(100000 + Math.random() * 900000).toString(),
                    name: e.target.name.value,
                    email: user.email 
                };
                const updated = [...profiles, newProfile];
                setProfiles(updated);
                localStorage.setItem('bv_profiles', JSON.stringify(updated));
                localStorage.setItem(`bv_txs_${newProfile.id}`, JSON.stringify([{
                    id: Date.now().toString(), amount: 1.00, type: 'income', category: 'Welcome üéÅ', description: 'Opening Balance', timestamp: new Date().toISOString()
                }]));
                setActiveProfileId(newProfile.id);
                setView('dash');
            };

            const handleTransfer = (e) => {
                e.preventDefault();
                const recipientId = e.target.recipientId.value.trim();
                const amount = parseFloat(e.target.amount.value);

                if (recipientId === activeProfileId) {
                    setErrorMsg("Error: You cannot send money to yourself.");
                    return;
                }
                if (amount > stats.balance) {
                    setErrorMsg("Insufficient funds.");
                    return;
                }

                const target = profiles.find(p => p.id === recipientId);
                if (!target) {
                    setErrorMsg("Trason ID not found.");
                    return;
                }

                const newSenderTxs = [{ id: Date.now().toString(), amount, type: 'expense', category: 'Transfer Out', description: `To: ${target.name}`, timestamp: new Date().toISOString() }, ...transactions];
                setTransactions(newSenderTxs);
                localStorage.setItem(`bv_txs_${activeProfileId}`, JSON.stringify(newSenderTxs));

                const recipientTxs = JSON.parse(localStorage.getItem(`bv_txs_${recipientId}`) || '[]');
                recipientTxs.push({ id: (Date.now()+1).toString(), amount, type: 'income', category: 'Transfer In', description: `From: ${activeProfile.name}`, timestamp: new Date().toISOString() });
                localStorage.setItem(`bv_txs_${recipientId}`, JSON.stringify(recipientTxs));

                setShowTransferModal(false);
                confetti();
            };

            const handleAdminLogin = (e) => {
                e.preventDefault();
                if (e.target.pass.value === 'SleepySFJT') {
                    setIsAdminLoggedIn(true);
                    setErrorMsg('');
                } else {
                    setErrorMsg('Incorrect Admin Password');
                }
            };

            const adminAdjustBalance = (profileId, type) => {
                const amount = parseFloat(prompt(`Enter amount to ${type}:`));
                if (isNaN(amount)) return;
                const txs = JSON.parse(localStorage.getItem(`bv_txs_${profileId}`) || '[]');
                txs.push({ id: Date.now().toString(), amount, type: type === 'add' ? 'income' : 'expense', category: 'Admin Action üõ†Ô∏è', description: 'Admin Adjustment', timestamp: new Date().toISOString() });
                localStorage.setItem(`bv_txs_${profileId}`, JSON.stringify(txs));
                if (profileId === activeProfileId) setTransactions([...txs].reverse());
                alert('Balance Adjusted');
            };

            if (!user) return (
                <div className="min-h-screen flex items-center justify-center p-6">
                    <div className="max-w-md w-full glass p-8 rounded-[2.5rem] shadow-2xl animate-spring">
                        <h1 className="text-2xl font-black text-center mb-8">School Bank</h1>
                        <form onSubmit={handleAuth} className="space-y-4">
                            <input name="email" type="email" required placeholder="Email" className="w-full px-6 py-4 rounded-xl bg-slate-100 dark:bg-slate-800 outline-none" />
                            <input name="password" type="password" required placeholder="Password" className="w-full px-6 py-4 rounded-xl bg-slate-100 dark:bg-slate-800 outline-none" />
                            <button className="w-full py-4 bg-indigo-600 text-white rounded-xl font-black">Login</button>
                        </form>
                    </div>
                </div>
            );

            if (!activeProfileId && view !== 'create_profile') return (
                <div className="min-h-screen p-6 pt-safe">
                    <div className="max-w-md mx-auto space-y-6">
                        <div className="flex justify-between items-center">
                            <h1 className="text-2xl font-black">Accounts</h1>
                            <button onClick={() => setShowAdminModal(true)} className="p-2 bg-slate-100 dark:bg-slate-800 rounded-lg"><Icon name="lock" size={16}/></button>
                        </div>
                        <div className="space-y-3">
                            {profiles.map(p => (
                                <button key={p.id} onClick={() => setActiveProfileId(p.id)} className="w-full p-5 rounded-2xl bg-white dark:bg-slate-900 flex items-center justify-between shadow-sm">
                                    <div className="text-left"><span className="font-bold block">{p.name}</span><span className="text-[10px] text-slate-400 font-mono uppercase">ID: {p.id}</span></div>
                                    <Icon name="chevron" size={16} />
                                </button>
                            ))}
                            <button onClick={() => setView('create_profile')} className="w-full py-5 rounded-2xl border-2 border-dashed border-slate-200 dark:border-slate-800 text-slate-400 font-black text-xs">Ôºã New Account</button>
                        </div>
                    </div>
                    {showAdminModal && (
                        <div className="fixed inset-0 z-[70] bg-black/80 backdrop-blur-md flex items-center justify-center p-6">
                            <div className="bg-white dark:bg-slate-900 w-full max-w-md rounded-[2rem] p-8">
                                {!isAdminLoggedIn ? (
                                    <form onSubmit={handleAdminLogin} className="space-y-4">
                                        <h2 className="font-black text-center">Admin Access</h2>
                                        {errorMsg && <p className="text-red-500 text-[10px] text-center">{errorMsg}</p>}
                                        <input name="pass" type="password" placeholder="Admin Password" className="w-full p-4 rounded-xl bg-slate-100 dark:bg-slate-800 outline-none" />
                                        <button className="w-full py-4 bg-black text-white rounded-xl font-black">Unlock</button>
                                        <button type="button" onClick={() => setShowAdminModal(false)} className="w-full text-xs text-slate-400">Cancel</button>
                                    </form>
                                ) : (
                                    <div className="space-y-4 max-h-[70vh] overflow-y-auto">
                                        <h2 className="font-black">Admin Panel</h2>
                                        {profiles.map(p => (
                                            <div key={p.id} className="p-4 bg-slate-50 dark:bg-slate-800 rounded-xl space-y-2">
                                                <p className="font-bold">{p.name} ({p.id})</p>
                                                <p className="text-[10px] text-slate-400">Login: {p.email}</p>
                                                <div className="flex gap-2">
                                                    <button onClick={() => adminAdjustBalance(p.id, 'add')} className="flex-1 py-2 bg-emerald-500 text-white text-[10px] font-black rounded-lg">ADD $$</button>
                                                    <button onClick={() => adminAdjustBalance(p.id, 'spend')} className="flex-1 py-2 bg-rose-500 text-white text-[10px] font-black rounded-lg">SUBTRACT $$</button>
                                                </div>
                                            </div>
                                        ))}
                                        <button onClick={() => {setIsAdminLoggedIn(false); setShowAdminModal(false);}} className="w-full py-4 border rounded-xl font-black">Close</button>
                                    </div>
                                )}
                            </div>
                        </div>
                    )}
                </div>
            );

            if (view === 'create_profile') return (
                <div className="min-h-screen p-6 pt-safe flex items-center justify-center">
                    <form onSubmit={handleCreateProfile} className="max-w-md w-full glass p-8 rounded-[2.5rem] space-y-4">
                        <h2 className="text-xl font-black mb-4">Create Account</h2>
                        <input name="name" required placeholder="Full Name" className="w-full px-6 py-4 rounded-xl bg-slate-100 dark:bg-slate-800 outline-none" />
                        <button className="w-full py-4 bg-indigo-600 text-white rounded-xl font-black">Confirm</button>
                        <button type="button" onClick={() => setView('dash')} className="w-full text-slate-400 text-xs font-bold">Cancel</button>
                    </form>
                </div>
            );

            return (
                <div className="max-w-md mx-auto min-h-screen flex flex-col pt-safe pb-32">
                    <header className="px-6 py-4 flex items-center justify-between sticky top-0 z-40 bg-mesh/80 backdrop-blur-md">
                        <div className="flex items-center gap-3">
                            <div className={`w-10 h-10 rounded-xl bg-indigo-600 flex items-center justify-center text-white shadow-md`}><Icon name="chart" size={20} /></div>
                            <div><p className="text-[9px] font-black uppercase text-slate-400">ID: {activeProfile.id}</p><h2 className="text-lg font-black">{activeProfile.name}</h2></div>
                        </div>
                        <button onClick={() => setActiveProfileId(null)} className="p-3 bg-white dark:bg-slate-900 rounded-xl"><Icon name="user" size={18}/></button>
                    </header>
                    <main className="px-6 space-y-6">
                        <section className="p-8 rounded-[2.5rem] bg-indigo-600 text-white shadow-xl animate-slide-up">
                            <p className="text-[10px] font-black opacity-70 uppercase mb-1">Balance</p>
                            <h3 className="text-5xl font-black mb-8">${stats.balance.toLocaleString()}</h3>
                        </section>
                        <div className="space-y-3">
                            <h4 className="text-[10px] font-black text-slate-400 uppercase">Recent Activity</h4>
                            {transactions.map(t => (
                                <div key={t.id} className="bg-white dark:bg-slate-900 p-4 rounded-2xl flex items-center justify-between shadow-sm">
                                    <div className="flex items-center gap-3">
                                        <div className={`w-10 h-10 rounded-xl flex items-center justify-center font-bold ${t.type === 'income' ? 'bg-emerald-50 text-emerald-500' : 'bg-rose-50 text-rose-500'}`}>{t.type === 'income' ? '+' : '‚àí'}</div>
                                        <div><p className="text-sm font-black">{t.description}</p><p className="text-[9px] font-black text-slate-400 uppercase">{t.category}</p></div>
                                    </div>
                                    <p className={`font-black text-sm ${t.type === 'income' ? 'text-emerald-500' : ''}`}>${t.amount.toLocaleString()}</p>
                                </div>
                            ))}
                        </div>
                    </main>
                    <nav className="fixed bottom-6 left-6 right-6 z-50">
                        <div className="max-w-sm mx-auto glass border border-white/50 shadow-2xl rounded-[2.5rem] p-3 flex justify-around items-center h-20">
                            <button onClick={() => setShowTransferModal(true)} className="flex flex-col items-center gap-1 text-slate-400"><Icon name="send" size={20}/><span className="text-[8px] font-black uppercase">Send</span></button>
                            <button onClick={() => {const amt=parseFloat(prompt('Deposit Amount:')); if(!isNaN(amt)) setTransactions([{id:Date.now().toString(), amount:amt, type:'income', category:'Quick Deposit', description:'Manual Entry', timestamp:new Date().toISOString()}, ...transactions])}} className="w-16 h-16 rounded-2xl bg-indigo-600 text-white flex items-center justify-center shadow-lg -mt-12 border-4 border-white dark:border-slate-950"><Icon name="plus" size={28}/></button>
                            <button className="flex flex-col items-center gap-1 text-slate-400 opacity-50"><Icon name="lock" size={20}/><span className="text-[8px] font-black uppercase">Vault</span></button>
                        </div>
                    </nav>
                    {showTransferModal && (
                        <div className="fixed inset-0 z-[60] bg-slate-950/60 backdrop-blur-sm flex items-end justify-center p-4">
                            <div className="w-full max-w-sm bg-white dark:bg-slate-900 rounded-[2rem] p-8 animate-spring mb-safe">
                                <div className="flex justify-between items-center mb-6"><h3 className="font-black text-xs uppercase tracking-widest">Transfer</h3><button onClick={() => {setShowTransferModal(false); setErrorMsg('');}} className="text-slate-400">‚úï</button></div>
                                <form onSubmit={handleTransfer} className="space-y-5">
                                    {errorMsg && <p className="text-[10px] font-black text-rose-500 text-center">{errorMsg}</p>}
                                    <input name="recipientId" type="number" required placeholder="Recipient Trason ID" className="w-full p-4 rounded-xl bg-slate-50 dark:bg-slate-800 font-bold text-xs outline-none" />
                                    <input name="amount" type="number" step="0.01" required placeholder="$ 0.00" className="w-full bg-slate-50 dark:bg-slate-800 p-6 rounded-2xl text-4xl font-black text-center outline-none" />
                                    <button className="w-full py-5 rounded-xl text-white font-black bg-indigo-600 text-xs uppercase">Send Now</button>
                                </form>
                            </div>
                        </div>
                    )}
                </div>
            );
        }
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>